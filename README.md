# Build plugin

Track your build data.

## Installation

-   Yarn

```bash
yarn add build-plugin
```

-   NPM

```bash
npm install --save build-plugin
```

## Usage

Inside your `webpack.config.js`.

```js
const BuildPlugin = require('build-plugin');

module.exports = {
    plugins: [new BuildPlugin()]
};
```

**📝 Note: It is important to have the plugin in the first position in order to report every other plugins.**

## Configuration

The Build plugin accepts many options:

### apiKey

> default: `null`

In order to submit your metrics into your own organisation, you have to use [your own API Key](https://app.datadoghq.com/account/settings#api).

Without a key, the plugin won't send anything to Datadog, you can use [`output`](./README.md#output) in order to have an idea of what's being tracked.

### endPoint

> default: `"app.datadoghq.com"`

To which endpoint will the metrics be sent.

### disabled

> default: `false`

Plugin will be disabled and won't track anything.

### prefix

> default: `""`

Add a prefix to all the metrics sent.

### output

> default: `true`

If `true`, you'll see a top 5 of all metrics tracked by the plugin.
If a path, you'll also save json files at this location:

-   `dependencies.json`: track all dependencies and dependents of your modules.
-   `metrics.json`: an array of all the metrics that would be sent to Datadog.
-   `stats.json`: the `stats` object of webpack.
-   `timings.json`: timing data for modules, loaders and plugins.

### tags

> default: `[]`

An array of tags to apply to all metrics.

### timestamps

> default: `Date.now()`

Which timestamp to use when submitting your metrics.

### filters

> default: `[]`

You can add as many filters as you want. They are just functions getting the `metric` as an argument.

They should return the same metric, or whatever you do with it or even `null` to remove it.

It is a good way to filter out what you don't want to send.

Examples:

```javascript
filters: [
    // Filter on names.
    metric =>
        metric.tags.reduce(
            (previous, current) =>
                // Remove sourcemaps.
                !/^assetName:.*\.map$/.test(current) &&
                // Remove third parties.
                !/^moduleName:\/node_modules/.test(current) &&
                previous,
            metric
        ) || null,
    // Filter on thresholds.
    metric => {
        const thresholds = {
            size: 100000,
            count: 10,
            duration: 1000
        };
        return metric.value > thresholds[metric.type] ? metric : null;
    }
];
```

## Metrics

Here's the list of metrics and their corresponding tags:
|Metric | Tags | Type | Description |
|:------|:-----|:-----|:------------|
|`${prefix}.assets.count` | `[]` | count | Number of assets. |
|`${prefix}.assets.size` | `[assetName:${name}, assetType:${type}]` | bytes | Size of an asset file. |
|`${prefix}.chunks.count` | `[]` | count | Number of chunks. |
|`${prefix}.chunks.modules.count` | `[chunkName:${name}]` | count | Number of modules in a chunk. |
|`${prefix}.chunks.size` | `[chunkName:${name}]` | bytes | Size of a chunk. |
|`${prefix}.compilation.duration` | `[]` | milliseconds | Duration of the build. |
|`${prefix}.entries.assets.count` | `[entryName:${name}]` | count | Number of assets from an entry. |
|`${prefix}.entries.chunks.count` | `[entryName:${name}]` | count | Number of chunks from an entry. |
|`${prefix}.entries.count` | `[]` | count | Number of entries. |
|`${prefix}.entries.modules.count` | `[entryName:${name}]` | count | Number of modules from an entry. |
|`${prefix}.entries.size` | `[entryName:${name}]` | bytes | Size of an entry file. |
|`${prefix}.errors.count` | `[]` | count | Number of errors generated by the build. |
|`${prefix}.loaders.count` | `[]` | count | Number of loaders. |
|`${prefix}.loaders.duration` | `[loaderName:${name}]` | milliseconds | Runtime duration of a loader. |
|`${prefix}.loaders.increment` | `[loaderName:${name}]` | count | Number of hit a loader had. |
|`${prefix}.modules.count` | `[]` | count | Number of modules.|
|`${prefix}.modules.dependencies` | `[moduleName:${name}, moduleType:${type}]` | count | Number of dependencies a module has. |
|`${prefix}.modules.dependents` | `[moduleName:${name}, moduleType:${type}]` | count | Number of dependents a module has. |
|`${prefix}.modules.size` | `[moduleName:${name}, moduleType:${type}]` | bytes | Size of a module. |
|`${prefix}.modules.tree.count` | `[moduleName:${name}, moduleType:${type}]` | count | Number of files in the tree of dependencies of a module. |
|`${prefix}.modules.tree.size` | `[moduleName:${name}, moduleType:${type}]` | bytes | Size of the tree of dependencies of a module. |
|`${prefix}.plugins.count` | `[]` | count | Number of plugins. |
|`${prefix}.plugins.duration` | `[pluginName:${name}]` | milliseconds | Total runtime duration of a plugin. |
|`${prefix}.plugins.hooks.duration` | `[pluginName:${name}, hookName:${name}]` | milliseconds | Runtime duration of a hook. |
|`${prefix}.plugins.hooks.increment` | `[pluginName:${name}, hookName:${name}]` | count | Number of hit a hook had. |
|`${prefix}.plugins.increment` | `[pluginName:${name}]` | count | Number of hit a plugin had. |
|`${prefix}.plugins.meta.duration` | `[pluginName:datadogwebpackplugin]` | milliseconds | Duration of the process of the Webpack Datadog plugin. |
|`${prefix}.warnings.count` | `[]` | count | Number of warnings generated by the build. |
