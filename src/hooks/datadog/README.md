# Datadog integration

You can directly send all the data gathered by the plugin into your Datadog organisation.

## Configuration

Pass a `datadog` object to your plugin's configuration.

### `datadog.apiKey`

> default: `null`

In order to submit your metrics into your own organisation, you have to use [your own API Key](https://app.datadoghq.com/account/settings#api).

Without a key, the plugin won't send anything to Datadog, you can use [`output`](./README.md#output) in order to have an idea of what's being tracked.

### `datadog.endPoint`

> default: `"app.datadoghq.com"`

To which endpoint will the metrics be sent.

### `datadog.prefix`

> default: `""`

Add a prefix to all the metrics sent.

### `datadog.tags`

> default: `[]`

An array of tags to apply to all metrics.

### `datadog.timestamps`

> default: `Date.now()`

Which timestamp to use when submitting your metrics.

### `datadog.filters`

> default: [`[ filterTreeMetrics, filterSourcemapsAndNodeModules, filterMetricsOnThreshold ]`](./helpers.ts)

You can add as many filters as you want. They are just functions getting the `metric` as an argument.

They should return the same metric, or whatever you do with it or even `null` to remove it.

It is a good way to filter out what you don't want to send.

We're adding a few default filters in order to reduce the noise.

When adding your own filters, it will remove these default filters.

You can still use them if you wish.

Example:

```javascript
import { defaultFilters } from '@datadog/build-plugin/dist/hooks/datadog/helpers';

new BuildPlugin({
    datadog: {
        filters: [
            // Keep the default filters.
            ...defaultFilters,
            // Clean asset names.
            (metric) => {
                metric.tags = metric.tags.map(t => {
                    if (/^assetName:/.test(t)) {
                        const newAssetName = t
                            .split('/')
                            // Only keep the name of the file.
                            .pop()
                            // Remove the hash from the name.
                            .replace(/(\.|-)[0-9a-f]{6,32}/, '');
                        return `assetName:${newAssetName}`;
                    }
                    return t;
                });
                return metric;
            },
        ],
    },
});
```

## Metrics

> :warning: Please note that this plugin can generate a lot of metrics, you can greatly reduce their number by tweaking the [`datadog.filters`](./#datadogfilters).

Here's the list of metrics and their corresponding tags:

|Metric | Tags | Type | Description |
|:------|:-----|:-----|:------------|
|`${prefix}.assets.count` | `[]` | count | Number of assets. |
|`${prefix}.assets.size` | `[assetName:${name}, assetType:${type}]` | bytes | Size of an asset file. |
|`${prefix}.chunks.count` | `[]` | count | Number of chunks. |
|`${prefix}.chunks.modules.count` | `[chunkName:${name}]` | count | Number of modules in a chunk. |
|`${prefix}.chunks.size` | `[chunkName:${name}]` | bytes | Size of a chunk. |
|`${prefix}.compilation.duration` | `[]` | milliseconds | Duration of the build. |
|`${prefix}.entries.assets.count` | `[entryName:${name}]` | count | Number of assets from an entry. |
|`${prefix}.entries.chunks.count` | `[entryName:${name}]` | count | Number of chunks from an entry. |
|`${prefix}.entries.count` | `[]` | count | Number of entries. |
|`${prefix}.entries.modules.count` | `[entryName:${name}]` | count | Number of modules from an entry. |
|`${prefix}.entries.size` | `[entryName:${name}]` | bytes | Size of an entry file. |
|`${prefix}.errors.count` | `[]` | count | Number of errors generated by the build. |
|`${prefix}.loaders.count` | `[]` | count | Number of loaders. |
|`${prefix}.loaders.duration` | `[loaderName:${name}]` | milliseconds | Runtime duration of a loader. |
|`${prefix}.loaders.increment` | `[loaderName:${name}]` | count | Number of hit a loader had. |
|`${prefix}.modules.count` | `[]` | count | Number of modules.|
|`${prefix}.modules.dependencies` | `[moduleName:${name}, moduleType:${type}]` | count | Number of dependencies a module has. |
|`${prefix}.modules.dependents` | `[moduleName:${name}, moduleType:${type}]` | count | Number of dependents a module has. |
|`${prefix}.modules.size` | `[moduleName:${name}, moduleType:${type}]` | bytes | Size of a module. |
|`${prefix}.modules.tree.count` | `[moduleName:${name}, moduleType:${type}]` | count | Number of files in the tree of dependencies of a module. |
|`${prefix}.modules.tree.size` | `[moduleName:${name}, moduleType:${type}]` | bytes | Size of the tree of dependencies of a module. |
|`${prefix}.plugins.count` | `[]` | count | Number of plugins. |
|`${prefix}.plugins.duration` | `[pluginName:${name}]` | milliseconds | Total runtime duration of a plugin. |
|`${prefix}.plugins.hooks.duration` | `[pluginName:${name}, hookName:${name}]` | milliseconds | Runtime duration of a hook. |
|`${prefix}.plugins.hooks.increment` | `[pluginName:${name}, hookName:${name}]` | count | Number of hit a hook had. |
|`${prefix}.plugins.increment` | `[pluginName:${name}]` | count | Number of hit a plugin had. |
|`${prefix}.plugins.meta.duration` | `[pluginName:datadogwebpackplugin]` | milliseconds | Duration of the process of the Webpack Datadog plugin. |
|`${prefix}.warnings.count` | `[]` | count | Number of warnings generated by the build. |
